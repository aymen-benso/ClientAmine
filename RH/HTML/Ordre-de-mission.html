<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../../css/ges-dem.css">
    <link rel="stylesheet" href="../../css/forms.css">
    <link rel="stylesheet" href="../CSS/RH.css">
    <link rel="stylesheet" href="../../css/side-index.css">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap" rel="stylesheet">
    <title>Document</title>
</head>
<body>
    <div class="sidebar">
            <a href="../../index.html">
                <div class="sidebar-logo"><img src="../../prophex.png" alt="Logo"></div>
            </a>
        <div class="sidebar-menus">
            <a href="../../index.html" class="Demandes"><ion-icon name="document-text-outline"></ion-icon>Demandes</a>
            <a href="../../Evaluation/HTML/evaluations.html" class="Évaluations"><ion-icon name="star-outline"></ion-icon>Évaluations</a>
            <a href="../../Mes Demandes/HTML/mes-demandes.html" class="Mes-Demandes"><ion-icon name="reader-outline"></ion-icon>Mes Demandes</a>
            <a href="../../Liste-Demandes/HTML/liste.html" class="Approval"><ion-icon name="clipboard-outline"></ion-icon>Approval</a>
            <a href="../../Compte/HTML/compte.html" class="compte"><ion-icon name="person-circle-outline"></ion-icon>compte</a>
            <a href="../../Favorites/HTML/favorites.html" class="Favorites"><ion-icon name="bookmark-outline"></ion-icon>Favorites</a>
            <a href="../../Setting/HTML/setting.html" class="s"><ion-icon class="Setting" name="settings-outline"></ion-icon>Setting</a>
        </div>
        <div class="sidebar-logout">
            <a href="#"><ion-icon name="log-out-outline"></ion-icon>Logout</a>
        </div>
    </div>
    <ion-icon class="menu-toggle" name="menu-outline"></ion-icon>
    <div class="main">
        <div class="main-navbar">
            <div class="home">
                <a href="../../index.html" class="ho"><ion-icon name="home-outline"></ion-icon></a>
            </div>
            <div class="search">
                <input type="text" placeholder="Quelle demande recherchez-vous ?">
                <button class="search-btn">Search</button>
                <button class="search-icon"><ion-icon name="search"></ion-icon></button>
            </div>
            <div class="profile">
                <a href="#" class="user"><ion-icon name="person-outline"></ion-icon></a>
            </div>
        </div>
        <div class="main-highlight">
            <div class="main-header">
                <h2 class="main-title">Recommendation</h2>
                <div class="main-arrow">
                    <ion-icon class="back" name="chevron-back-circle-outline"></ion-icon>
                    <ion-icon class="next" name="chevron-forward-circle-outline"></ion-icon>
                </div>
            </div>
            <div class="highlight-wrapper">
                <div class="highlight-card">
                    <img src="../../images/Vihecule.jpg" alt="Vihecule image" class="highlight-img">
                    <div class="highlight-desc">
                        <h4>Demande Vihecule</h4>
                        <p>MG</p>
                    </div>
                </div>
                <div class="highlight-card">
                    <img src="../../images/Ordre-de-mession.jpg" alt="Ordre de mession image" class="highlight-img">
                        <div class="highlight-desc">
                            <h4>Ordre De Mession</h4>
                            <p>RH</p>
                        </div>
                </div>
                <div class="highlight-card">
                    <img src="../../images/Documents.jpg" alt="Documents image" class="highlight-img">
                    <div class="highlight-desc">
                        <h4>Demande Des Document</h4>
                        <p>RH</p>
                    </div>
                </div>
                <div class="highlight-card">
                    <img src="../../images/Formation.jpg" alt="Formation image" class="highlight-img">
                    <div class="highlight-desc">
                        <h4>Demande De Formation</h4>
                        <p>Marketing</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="main-menus">
            <div class="main-filter">
                <div class="catg">
                    <h2 class="main-title">Departemnts <br>Menu</h2>
                    <div class="main-arrow">
                        <ion-icon class="back-menus" name="chevron-back-circle-outline"></ion-icon>
                        <ion-icon class="next-menus" name="chevron-forward-circle-outline"></ion-icon>
                    </div>
                </div>
                <div class="filter-wrapper">
                    <div class="filter-card" id="RH">
                        <div class="filter-icon">
                            <ion-icon name="document-text-outline"></ion-icon>
                        </div>
                        <p>RH</p>
                    </div>
                    <div class="filter-card" id="MG">
                        <div class="filter-icon">
                            <ion-icon name="construct-outline"></ion-icon>
                        </div>
                        <p>MG</p>
                    </div>
                    <div class="filter-card"id="MK">
                        <div class="filter-icon">
                            <ion-icon name="megaphone-outline"></ion-icon>
                        </div>
                        <p>Marketing</p>
                    </div>
                    <div class="filter-card" id="FC">
                        <div class="filter-icon">
                            <ion-icon name="cash-outline"></ion-icon>
                        </div>
                        <p>FC</p>
                    </div>
                    <div class="filter-card" id="CM">
                        <div class="filter-icon">
                            <ion-icon name="bag-handle-outline"></ion-icon>
                        </div>
                        <p>Comerciale</p>
                    </div>
                    <div class="filter-card" id="AC">
                        <div class="filter-icon">
                            <ion-icon name="cart-outline"></ion-icon>
                        </div>
                        <p>Achats</p>
                    </div>
                    <div class="filter-card" id="IT">
                        <div class="filter-icon">
                            <ion-icon name="code-slash-outline"></ion-icon>
                        </div>
                        <p>IT</p>
                    </div>
                </div>
            </div>
            <hr class="divider">
            <div class="forms">
                <h2 class="main-title">Ordre de Mission</h2>
                <form action="" method="post" id="demandeForm">
                    <div class="case">
                        <label for="Numero">N°</label>
                        <p></p>
                    </div>
                    <div class="case">
                        <label for="Nom">Chargé de mission</label>
                        <input type="text" name="user_name" id="Nom" placeholder="Nom d'utilisateur">
                    </div>
                    <div class="case">
                        <label for="fonction">Fonction</label>
                        <input type="text" name="fonction" id="fonction" placeholder="Fonction">
                    </div>
                    <div class="case">
                        <label for="destination">Destination</label>
                        <select id="destination" name="destination">
                            <option value="">Selectioner la moyen de transport</option>
                            <option value="CIRTA">CIRTA</option>
                            <option value="EL HIDHAB">EL HIDHAB</option>
                            <option value="WEST WATER">WEST WATER</option>
                            <option value="METIDJA">METIDJA</option>
                            <option value="PROFACT">PROFACT</option>
                            <option value="PROLEAN">PROLEAN</option>
                            <option value="PROPHEX">PROPHEX</option>
                            <option value="PROPHEX STOCK">PROPHEX STOCK</option>
                            <option value="Autre">Autre</option>
                        </select>
                    </div>
                    <div class="case">
                        <label for="objet">Objet de la Mission</label>
                        <input type="text" name="objet" id="objet" placeholder="Objet de la Mission">
                    </div>
                    <div class="case custom-dropdown">
                        <label for="moyen">Moyen de transport</label>
                        <select id="moyen" name="moyen">
                            <option value="">Selectioner la moyen de transport</option>
                            <option value="perso">Vehicule Personelle</option>
                            <option value="vehicule">Vehicule de Service</option>
                            <option value="Accompagnement">Accompagnement</option>
                            <option value="transport">Transport Public</option>
                            <option value="taxi">Taxi</option>
                            <option value="Avion">Avion</option>
                            <option value="Autre">Autre</option>
                        </select>
                    </div>
                    <div class="case">
                        <label for="dated">Date de départ</label>
                        <input type="date" name="dated" id="dated">
                    </div>
                    <div class="case">
                        <label for="heure">Heure de départ</label>
                        <input type="time" name="heure_depart" id="heure">
                    </div>
                    <div class="case">
                        <label for="dater">Date de retour</label>
                        <input type="date" name="dater" id="dater">
                    </div>
                    <div class="submit">
                        <input type="reset" value="Annuler" class="annuler">
                        <input type="submit" value="Submit" class="envoyer">
                        <input type="submit" value="Demande Vehicule" class="Demande-Vihecule">
                    </div>
                    <div class="remarque">Si vous souhaitez envoyer et passer à demande de véhicule en même temps, cliquez sur « Demande Véhicule »</div>
                </form>
            
                <script>
                    function getCookie(name) {
                        const value = `; ${document.cookie}`;
                        const parts = value.split(`; ${name}=`);
                        if (parts.length === 2) return parts.pop().split(';').shift();
                    }
            
                    document.addEventListener('DOMContentLoaded', () => {
                        const userCookie = getCookie('user');
                        if (userCookie) {
                            const user = JSON.parse(decodeURIComponent(userCookie));
                            document.getElementById('Nom').value = user.name;
                            document.getElementById('fonction').value = user.role;
                        } else {
                            alert('No user data found.');
                        }
                    });
            
                    document.getElementById('demandeForm').addEventListener('submit', (event) => {
                        event.preventDefault();
                        
                        const userCookie = getCookie('user');
                        if (!userCookie) {
                            alert('No user data found.');
                            return;
                        }
            
                        const user = JSON.parse(decodeURIComponent(userCookie));
                        const data = {
                            user_id: user.id,
                            user_name: document.getElementById('Nom').value,
                            date_debut: document.getElementById('dated').value,
                            date_fin: document.getElementById('dater').value,
                            heure_depart: document.getElementById('heure').value,
                            fonction: document.getElementById('fonction').value,
                            destination: document.getElementById('destination').value,
                            motif: document.getElementById('objet').value,
                            moyen_transport: document.getElementById('moyen').value,
                            statut: 'pending',
                            responsable_pr_id: user.responsable_pr_id,
                            responsable_approbation : false,
                            RH_accepted : false
                        };
            
                        fetch('http://127.0.0.1:8000/demande_ordre_mission/', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(data)
                        })
                        .then(response => response.json())
                        .then(data => {
                            console.log('Success:', data);
                            alert('Demande created successfully!');
                        })
                        .catch((error) => {
                            console.error('Error:', error);
                        });
                    });
                </script>
            </div>
        </div>
    </div>
</body>
<script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
<script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
<script src="https://code.jquery.com/jquery=2.2.4.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="../../JavaScript/filter-card.js"></script>
<script src="../../JavaScript/sidebar.js"></script>
<script src="../../JavaScript/steps.js"></script>
<script src="../../JavaScript/textarea.js"></script>
<script src="../JavaScript/RH.js"></script>
<script src="../../Setting/JavaScripte/setting.js"></script>
</html>